<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="runner.css">

<script type="text/javascript" charset="utf-8" src="utils/Loader.js"></script>
<script type="text/javascript" charset="utf-8" src="utils/ComparisonTests.js"></script>
<script type="text/javascript" charset="utf-8" src="Configuration.js"></script>

<script type="text/javascript" charset="utf-8">

var SetNames = [],
	SourceNames = [];

(function(){

var loader = SpecLoader(Configuration, ComparisonTests.parseQueryString(document.location.search.substr(1)));
var tester = new ComparisonTests();

var loadScript = function(object, base){
	for (var j = 0; j < object.length; j++)
		document.write('<scr'+'ipt src="' + (base || '') + object[j] + '.js" type="text/javascript"><\/script>');
};

var loadSpec = function(object, testBase, keyBase){
	for (var j = 0; j < object.length; j++)
		tester.add(testRunner((testBase || '') + object[j] + '.svg', (keyBase || '') + object[j] + '.png'), object[j]);
};

var testRunner = function(svgPath, pngPath){
	return function(completed, failed){
		var img = new Image();
		img.onload = function(){
			var parser = new ART.SVG.Parser();
			parser.inheritedStyles.viewportWidth = img.width;
			parser.inheritedStyles.viewportHeight = img.height;
			new Request.XML({
				url: svgPath,
				onSuccess: function(txt, doc){
					try {
					var result = parser.parse(doc);
					} catch (x){
						failed(x);
						throw x;
					}
					if (result == null){
						failed('Parser Failed: Returned null');
					} else {
						completed(result.toElement(), img);
					}
				},
				onFailure: function(){
					failed('Failed to load file: ' + svgPath);
				}
			}).get();
		};
		img.src = pngPath;
	};
};

loader.setSourceLoader(loadScript).setSpecLoader(loadSpec);
loader.run();

SetNames = loader.getSetNames();
SourceNames = loader.getSourceNames();

window.onload = function(){
	// Change title
	document.title = 'Specs for ' + Configuration.name;
	document.body.appendChild(tester.element);
	tester.run();
};

})();
</script>

<title>ART-SVG-Runner</title>
</head>
<body>
	<div id="framework_name"><script type="text/javascript">
		document.write(Configuration.name + ' ' + SourceNames.join(', ') + ' [Sets: ' + SetNames.join(', ') + ']');
	</script></div>
</body>
</html>
